databaseChangeLog:
  - changeSet:
      id: "002-create-test-data-set-table"
      author: "blocpress"
      changes:
        - createTable:
            tableName: test_data_set
            columns:
              - column:
                  name: id
                  type: UUID
                  constraints:
                    primaryKey: true
                    nullable: false

              - column:
                  name: template_id
                  type: UUID
                  constraints:
                    nullable: false
                    foreignKeyName: fk_test_data_set_template
                    references: template(id)
                    deleteCascade: true

              - column:
                  name: name
                  type: VARCHAR(255)
                  constraints:
                    nullable: false

              - column:
                  name: testData
                  type: jsonb
                  constraints:
                    nullable: false

              - column:
                  name: expectedPdf
                  type: BYTEA
                  constraints:
                    nullable: true

              - column:
                  name: pdfHash
                  type: VARCHAR(64)
                  constraints:
                    nullable: true

              - column:
                  name: createdAt
                  type: TIMESTAMP
                  defaultValueComputed: CURRENT_TIMESTAMP
                  constraints:
                    nullable: false

              - column:
                  name: updatedAt
                  type: TIMESTAMP
                  constraints:
                    nullable: true

        - createIndex:
            tableName: test_data_set
            indexName: idx_test_data_set_template_id
            columns:
              - column:
                  name: template_id

        - createIndex:
            tableName: test_data_set
            indexName: idx_test_data_set_created_at
            columns:
              - column:
                  name: created_at

        - sql:
            sql: "COMMENT ON TABLE test_data_set IS 'Test data sets für Templates mit optional gespeicherten expected PDFs für Regressions-Tests'"
            dbms: postgresql

        - sql:
            sql: "COMMENT ON COLUMN test_data_set.pdf_hash IS 'SHA-256 Hash des expected PDFs für schnellen Vergleich'"
            dbms: postgresql
