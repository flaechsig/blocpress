openapi: 3.0.3
info:
  title: Blocpress Server API
  version: 1.0.0
  description: >
    Blocpress Server provides HTTP APIs for document rendering and related services.
    The API is designed to be extensible; additional endpoints and service domains
    may be added over time without breaking existing integrations.

servers:
  - url: http://localhost:8080

tags:
  - name: Render
    description: Rendering documents
  - name: Template
    description: Template handling and merging

paths:
  /render:
    post:
      tags: [ Render ]
      operationId: renderDocument
      summary: render ODT to different output formats (ODT/PDF/RTF)
      description: >
        Render an ODT template to ODT/PDF/RTF. The rendering of ODT to ODT is usefull to update
        calculated fields like date or page numbers.
      parameters:
        - name: Accept
          in: header
          required: true
          schema:
            type: string
            enum:
              - application/vnd.oasis.opendocument.text
              - application/pdf
              - application/rtf
            example: application/pdf
          description: Desired response media type. If omitted, the server may choose a default.
      requestBody:
        required: true
        content:
          application/vnd.oasis.opendocument.text:
            schema:
              type: string
              format: binary
      responses:
        "200":
          description: Rendered document (binary) in 'outputFormat'
          headers:
            Content-Disposition:
              description: download filename
              schema:
                type: string
                example: attachment; filename="output.[pdf|rtf|odt]"
          content:
            application/pdf:
              schema:
                type: string
                format: binary
            application/rtf:
              schema:
                type: string
                format: binary
            application/vnd.oasis.opendocument.text:
              schema:
                type: string
                format: binary
        "400":
          description: Bad request (e.g. missing data, unknown output format)
        "406":
          description: Unsupported Media Type
        "500":
          description: Internal server error

  /template/merge:
    post:
      tags: [ Template ]
      operationId: mergeTemplate
      summary: Merge ODT template with JSON data and specify output format
      description: >
        Merge an ODT template with provided JSON data and specify the desired output format.
        This endpoint allows dynamic document generation by filling templates with data.
      parameters:
        - name: Accept
          in: header
          required: true
          schema:
            type: string
            enum:
              - application/pdf
              - application/rtf
              - application/vnd.oasis.opendocument.text
            example: application/pdf
          description: >
            Desired response media type. Must be one of: application/pdf, application/rtf, 
            application/vnd.oasis.opendocument.text.
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              required:
                - template
                - data
              properties:
                template:
                  type: string
                  format: binary
                  description: ODT template
                data:
                  type: string
                  description: JSON template data
      responses:
        "200":
          description: Merged document (binary) in specified format
          headers:
            Content-Disposition:
              description: download filename
              schema:
                type: string
                example: attachment; filename="merged-document.[pdf|rtf|odt]"
          content:
            application/pdf:
              schema:
                type: string
                format: binary
            application/rtf:
              schema:
                type: string
                format: binary
            application/vnd.oasis.opendocument.text:
              schema:
                type: string
                format: binary
        "400":
          description: Bad request (e.g. missing template, invalid JSON data, or invalid template structure)
        "406":
          description: Unsupported Media Type
        "500":
          description: Internal server error